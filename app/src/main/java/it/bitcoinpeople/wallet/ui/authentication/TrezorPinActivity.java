package it.bitcoinpeople.wallet.ui.authentication;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.HapticFeedbackConstants;
import android.view.MenuItem;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;

import it.bitcoinpeople.wallet.ui.GaActivity;
import it.bitcoinpeople.wallet.ui.R;
import it.bitcoinpeople.wallet.ui.UI;


public class TrezorPinActivity extends GaActivity {
    private StringBuffer value = new StringBuffer();

    @Override
    protected void onCreate(final Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_trezor_pin_dialog);
        setTitleBackTransparent();
        final TextView textView = UI.find(this, R.id.asteriskTextView);
        final Button[] buttons = new Button[] {
            // upside down
            UI.find(this, R.id.trezorPinButton7),
            UI.find(this, R.id.trezorPinButton8),
            UI.find(this, R.id.trezorPinButton9),
            UI.find(this, R.id.trezorPinButton4),
            UI.find(this, R.id.trezorPinButton5),
            UI.find(this, R.id.trezorPinButton6),
            UI.find(this, R.id.trezorPinButton1),
            UI.find(this, R.id.trezorPinButton2),
            UI.find(this, R.id.trezorPinButton3)
        };
        for (int i = 0; i < buttons.length; ++i) {
            final int ii = i;
            buttons[i].setOnClickListener(view -> {
                if (value.length() < 9) {
                    value.append((ii + 1));
                    textView.setText(String.format("%s *",textView.getText()));
                }
                view.performHapticFeedback(HapticFeedbackConstants.VIRTUAL_KEY);
            });
        }
        final ImageView button = UI.find(this, R.id.eraseButton);
        button.setOnClickListener(view -> {
            if (value.length() > 0) {
                value.deleteCharAt(value.length()-1);
                final CharSequence text = textView.getText();
                textView.setText(text.subSequence(0,text.length()-2));
            }
        });

        final Button next = UI.find(this, R.id.trezorPinNextButton);
        next.setOnClickListener(view -> {
            Intent intent = getIntent();
            intent.putExtra(String.valueOf(GaActivity.HARDWARE_PIN_REQUEST),value.toString());
            setResult(Activity.RESULT_OK, intent);
            finishOnUiThread();
        });

    }

    @Override
    public boolean onOptionsItemSelected(final MenuItem item) {
        switch (item.getItemId()) {
        case android.R.id.home:
            onBackPressed();
            return true;
        default:
            return super.onOptionsItemSelected(item);
        }
    }
}
